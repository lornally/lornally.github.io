> viewå°±æ˜¯widget

### å…³ç³»

view/scene/itemæ¶æ„ä¸­viewæœ‰ä¸¤ä¸ª:

* çˆ¶ç±»: QGraphicsView, åŸºç¡€ç±», ä¸€èˆ¬æƒ…å†µéƒ½ç”¨å®ƒ
* å­ç±»: QChartView, ç”¨æ¥å±•ç¤ºå›¾è¡¨, é…åˆQChartä½¿ç”¨, 
  * QChart ç»§æ‰¿è‡ª `QGraphicsWidget`ï¼Œè€Œ `QGraphicsWidget` åˆç»§æ‰¿è‡ª `QGraphicsObject` â†’ å®ƒæ˜¯ scene é‡Œçš„ä¸€æ£µ item æ ‘
  * ä¸è®ºæ˜¯qchartviewè¿˜æ˜¯qchartéƒ½ä¸æ˜¯qtæ ¸å¿ƒåº“æˆå‘˜, è€Œæ˜¯qtchartåº“æˆå‘˜
  * ç±»ä¼¼çš„è¿˜æœ‰qtsvgçš„QGraphicsSvgItem

### å†…å®¹

ä¸€ã€setWindowFlags å¸¸ç”¨å€¼ï¼ˆ**å¯¹ç³»ç»Ÿçª—å£ç®¡ç†å™¨è¯´è¯**ï¼‰

| æ ‡å¿—                       | ä½œç”¨                             |
| -------------------------- | -------------------------------- |
| `Qt::FramelessWindowHint`  | å»æ‰ç³»ç»Ÿæ ‡é¢˜æ /è¾¹æ¡†              |
| `Qt::WindowStaysOnTopHint` | æœ¬åº”ç”¨å†…æœ€ä¸Šå±‚                   |
| `Qt::Tool`                 | å°å·¥å…·æ¿ï¼ˆç´§å‡‘æ ‡é¢˜ã€ä¸è¿› Cmd+`ï¼‰ |
| `Qt::Window`               | æ™®é€šç‹¬ç«‹çª—å£ï¼ˆé»˜è®¤å°±æœ‰ï¼‰         |
| `Qt::Popup`                | å¼¹å‡ºå±‚ï¼ˆç‚¹å‡»å¤–éƒ¨è‡ªåŠ¨æ¶ˆå¤±ï¼‰       |
| `Qt::Dialog`               | å¯¹è¯æ¡†æ ·å¼ï¼ˆä»…å…³é—­æŒ‰é’®ï¼‰         |

**ç”¨æ³•**ï¼šæŒ‰ä½æˆ–  
```python
view.setWindowFlags(Qt.Tool | Qt.FramelessWindowHint)
```

------------------------------------------------
äºŒã€setAttribute å¸¸ç”¨å€¼ï¼ˆ**å¯¹ Qt è‡ªèº«è¡Œä¸ºè¯´è¯**ï¼‰

| å±æ€§                       | ä½œç”¨                                                |
| -------------------------- | --------------------------------------------------- |
| `WA_TranslucentBackground` | å…è®¸èƒŒæ™¯é€æ˜ï¼ˆä½ è‡ªå·±ç”» rgbaï¼‰                       |
| `WA_DeleteOnClose`         | å…³é—­æ—¶è‡ªåŠ¨ `delete`                                 |
| `WA_ShowWithoutActivating` | å¼¹å‡ºä½†ä¸æŠ¢ç„¦ç‚¹ï¼ˆé€‚åˆæµ®å±‚æç¤ºï¼‰                      |
| `WA_NoSystemBackground`    | ä¸æ“¦é™¤èƒŒæ™¯ï¼ˆçœä¸€æ¬¡ fillRectï¼‰                       |
| `WA_AlwaysShowToolTips`    | çˆ¶çª—æœªæ¿€æ´»ä¹Ÿæ˜¾ç¤º tooltip                            |
| `WA_Hover`                 | å¼ºåˆ¶äº§ç”Ÿ `hoverMoveEvent`ï¼ˆæ— æ­¤åˆ™åªæœ‰ enter/leaveï¼‰ |
| WA_NoMousePropagation      | ä¸æ¥å—ç„¦ç‚¹                                          |

**ç”¨æ³•**ï¼šå•å±æ€§å¼€å…³  
```python
view.setAttribute(Qt.WA_TranslucentBackground, True)
```

------------------------------------------------
ä¸‰ã€view çš„ã€Œæ‹–åŠ¨/ç¼©æ”¾/æ‰‹åŠ¿ã€è®¾ç½® â€”â€” **éƒ½ä¸æ˜¯è™šå‡½æ•°**ï¼Œåªæ˜¯æ™®é€šæ¥å£

| åŠŸèƒ½     | æ¥å£ï¼ˆéè™šå‡½æ•°ï¼‰                                             | è¯´æ˜                      |
| -------- | ------------------------------------------------------------ | ------------------------- |
| æ»šè½®ç¼©æ”¾ | `view.setTransformationAnchor(QGraphicsView.AnchorUnderMouse)` | é”šç‚¹                      |
| å±…ä¸­ç¼©æ”¾ | `view.setResizeAnchor(...)`                                  | çª—å£resizeæ—¶é”šç‚¹          |
| æŠ—é”¯é½¿   | `view.setRenderHint(QPainter.Antialiasing)`                  | æ™®é€šè®¾ç½®                  |
| æ‹–æ‹½æ¨¡å¼ | `view.setDragMode(QGraphicsView.ScrollHandDrag)`             | æ‰‹å‹æ‹–ç”»å¸ƒ                |
| æ‰‹åŠ¿     | `view.grabGesture(Qt.PinchGesture)`                          | æ³¨å†Œå³å¯æ”¶ `gestureEvent` |
| æ»šåŠ¨æ¡   | `view.setVerticalScrollBarPolicy(Qt.ScrollBarAlwaysOff)`     | å…³æ‰åŸç”Ÿæ»šåŠ¨æ¡            |
| å¯¹é½ç½‘æ ¼ | `view.setAlignment(Qt.AlignLeft | Qt.AlignTop)`              | è§†å›¾å¯¹é½æ–¹å¼              |

------------------------------------------------
**QGraphicsView å°±æ˜¯ Qt çš„â€œè¾“å…¥ä¸­æ¢â€**â€”â€”**æ‰€æœ‰é¼ æ ‡ã€æ»šè½®ã€é”®ç›˜ã€æ‰‹åŠ¿ã€è§¦æ‘¸ã€æ‹–æ‹½ã€å¿«æ·é”®ã€ç¼©æ”¾ã€å¹³ç§»**éƒ½èƒ½é€šè¿‡å®ƒæ•è·

------------------------------------------------
ä¸€ã€é¼ æ ‡ & æ»šè½®ï¼ˆæœ€å¸¸ç”¨ï¼‰

| åŠŸèƒ½         | ç›¸å…³æ¥å£/è®¾ç½®                      | å…¸å‹ä¸€è¡Œä»£ç                 |
| ------------ | ---------------------------------- | --------------------------- |
| å·¦é”®ç‚¹å‡»æ‹¾å– | é‡è½½ `mousePressEvent`             | `it = self.itemAt(e.pos())` |
| ä¸­é”®æ‹–æ‹½å¹³ç§» | `setDragMode(ScrollHandDrag)`      | ä¸€è¡Œè®¾ç½®ï¼Œè‡ªå¸¦æ‰‹å‹          |
| æ»šè½®ç¼©æ”¾     | é‡è½½ `wheelEvent` + `scale()`      | `self.scale(1.15, 1.15)`    |
| é¼ æ ‡æ ·å¼     | `setCursor(Qt::OpenHand)`          | å®æ—¶å˜æ‰‹å‹                  |
| æ‹¾å–ç²¾åº¦     | `setViewportUpdate(MinimalUpdate)` | å‡å°‘é—ªçƒ                    |

------------------------------------------------
äºŒã€é”®ç›˜ & å¿«æ·é”®

| åŠŸèƒ½             | ç›¸å…³æ¥å£/è®¾ç½®                    | å…¸å‹ä¸€è¡Œä»£ç                                                  |
| ---------------- | -------------------------------- | ------------------------------------------------------------ |
| æ–¹å‘é”®ç§»åŠ¨é€‰ä¸­é¡¹ | é‡è½½ `keyPressEvent`             | `if e.key()==Qt.Key_Left: item.moveBy(-10,0)`                |
| å…¨å±€å¿«æ·é”®       | `QAction + QKeySequence`         | `action = QAction("Del", self); action.setShortcut(QKeySequence.Delete)` |
| è§†å›¾çº§çƒ­é”®       | `QShortcut(self)`                | `QShortcut(QKeySequence("Ctrl+="), self, self.zoomIn)`       |
| ç„¦ç‚¹ç­–ç•¥         | `setFocusPolicy(Qt.StrongFocus)` | è®© View èƒ½æ”¶é”®ç›˜äº‹ä»¶                                         |

------------------------------------------------
ä¸‰ã€æ‰‹åŠ¿ & å¤šç‚¹è§¦æ§ï¼ˆmacOS trackpad / Win è§¦æ§ï¼‰

| åŠŸèƒ½         | ç›¸å…³æ¥å£/è®¾ç½®                  | å…¸å‹ä¸€è¡Œä»£ç                        |
| ------------ | ------------------------------ | ---------------------------------- |
| ä¸¤æŒ‡æåˆç¼©æ”¾ | `grabGesture(Qt.PinchGesture)` | æ”¶ `QPinchGesture`                 |
| ä¸¤æŒ‡æ»‘åŠ¨å¹³ç§» | `grabGesture(Qt.PanGesture)`   | æ”¶ `QPanGesture`                   |
| å…œåº•æ€»å…¥å£   | é‡è½½ `event()`                 | `if e.type()==QEvent.Gesture: ...` |

------------------------------------------------
å››ã€æ‹–æ‹½ï¼ˆæ–‡ä»¶æ‹–è¿›æ¥ç”ŸæˆèŠ‚ç‚¹ï¼‰

| åŠŸèƒ½         | ç›¸å…³æ¥å£/è®¾ç½®          | å…¸å‹ä¸€è¡Œä»£ç                    |
| ------------ | ---------------------- | ------------------------------ |
| æ¥æ”¶æ–‡ä»¶æ‹–æ”¾ | `setAcceptDrops(True)` | View çº§                        |
| å¼€å§‹æ‹–æ‹½     | `QDrag + mimeData`     | Item é‡Œ `mousePressEvent` å¯åŠ¨ |
| æ‹–æ‹½è¿›å…¥     | é‡è½½ `dragEnterEvent`  | åˆ¤æ–­ `mimeData().hasUrls()`    |
| æ”¾ä¸‹         | é‡è½½ `dropEvent`       | `pos = event.scenePos()`       |

------------------------------------------------
äº”ã€ç¼©æ”¾/æ—‹è½¬/å¯¹é½ï¼ˆéè™šå‡½æ•°ï¼Œçº¯è®¾ç½®ï¼‰

| åŠŸèƒ½             | ç›¸å…³æ¥å£/è®¾ç½®                               | å…¸å‹ä¸€è¡Œä»£ç       |
| ---------------- | ------------------------------------------- | ----------------- |
| ä»¥å…‰æ ‡ä¸ºä¸­å¿ƒç¼©æ”¾ | `setTransformationAnchor(AnchorUnderMouse)` | å•æ‰‹å‹ç¼©æ”¾        |
| å¹³æ»‘ç¼©æ”¾         | `setRenderHint(Antialiasing)`               | è¾¹ç¼˜ä¸é”¯é½¿        |
| æ—‹è½¬             | `rotate(angle)` / `setTransform`            | `view.rotate(15)` |
| å¯¹é½ç½‘æ ¼         | `setAlignment(Qt.AlignLeft | Qt.AlignTop)`  | è§†å›¾å·¦ä¸Šè§’å¯¹é½    |
| æœ€å¤§æ€§èƒ½         | `setViewportUpdate(MinimalUpdate)`          | åªé‡ç»˜å˜åŒ–çŸ©å½¢    |

------------------------------------------------
å…­ã€è§¦æ‘¸ & å¹³æ¿ç¬”

| åŠŸèƒ½       | ç›¸å…³æ¥å£/è®¾ç½®                                                | å…¸å‹ä¸€è¡Œä»£ç                  |
| ---------- | ------------------------------------------------------------ | ---------------------------- |
| å¤šç‚¹è§¦æ§   | `grabGesture(Qt.TapGesture | Qt.PanGesture | Qt.PinchGesture)` | ç»Ÿä¸€æ”¶ `QGesture`            |
| å‹æ„Ÿ/å€¾æ–œ  | é‡è½½ `tabletEvent(QTabletEvent)`                             | æ”¶ `pressure/rotation`       |
| å…œåº•æ€»å…¥å£ | é‡è½½ `event()`                                               | å…ˆæ‹¦æˆª `QEvent::TouchUpdate` |

------------------------------------------------
ä¸ƒã€äº‹ä»¶è¿‡æ»¤ & å…¨å±€é’©å­

| åŠŸèƒ½           | ç›¸å…³æ¥å£/è®¾ç½®                   | å…¸å‹ä¸€è¡Œä»£ç            |
| -------------- | ------------------------------- | ---------------------- |
| å…¨å±€äº‹ä»¶è¿‡æ»¤å™¨ | `installEventFilter(self)`      | å¯æ‹¦æˆªæ‰€æœ‰äº‹ä»¶         |
| Scene çº§è¿‡æ»¤å™¨ | `installSceneEventFilter(item)` | åªè¿‡æ»¤æŒ‡å®š Item çš„äº‹ä»¶ |
| åº•å±‚å…œåº•       | é‡è½½ `event(QEvent)`            | ä»»ä½•æ–°äº‹ä»¶éƒ½èƒ½å…ˆæ‹¦æˆª   |

------------------------------------------------
å…«ã€æ€§èƒ½ & è°ƒè¯•å¼€å…³

| åŠŸèƒ½         | ç›¸å…³æ¥å£/è®¾ç½®                                      | å…¸å‹ä¸€è¡Œä»£ç      |
| ------------ | -------------------------------------------------- | ---------------- |
| æ˜¾ç¤º FPS     | `setViewport(new QOpenGLWidget)` + `QElapsedTimer` | 60 FPS å®æµ‹      |
| åªæ›´æ–°å˜åŒ–åŒº | `setViewportUpdate(MinimalUpdate)`                 | å¤§åœºæ™¯ä¸é—ª       |
| æ‰“å°åœºæ™¯     | `render(QPainter, targetRect, sourceRect)`         | ä¸€é”®å¯¼å‡º PNG/PDF |

------------------------------------------------
#### å¤„ç†åˆ†ç±»

* æ‰‹åŠ¨å¤„ç†äº‹ä»¶(å¤§éƒ¨åˆ†æƒ…å†µå¹¶ä¸éœ€è¦), é‡è½½æŸä¸ªè™šå‡½æ•°xxxEvent
* ç¼©æ”¾å¹³ç§» â†’ setXxx + éè™šå‡½æ•°
* æ‰‹åŠ¿è§¦æ‘¸ â†’ grabGesture + event() å…œåº•
* æ€§èƒ½ â†’ OpenGL + MinimalUpdate

### å…³äºè™šå‡½æ•°å’Œè®¾ç½®

* setXxx / grabXxx / scale / rotate â†’ æ™®é€šæ¥å£ï¼Œéè™šå‡½æ•°ï¼ŒæŒ‰éœ€å¼€å…³
* xxxEvent â†’ è™šå‡½æ•°ï¼Œä»¥ Event ç»“å°¾ï¼Œå¿…é¡»é‡è½½æ‰èƒ½æ”¶äº‹ä»¶

æ‰€ä»¥ï¼š

- æƒ³ã€Œæ‰“å¼€å¹³æ»‘ç¼©æ”¾ã€â†’ è°ƒ `setRenderHint()`ï¼ˆ**æ™®é€šæ¥å£**ï¼‰
- æƒ³ã€Œè‡ªå·±å¤„ç†æ»šè½®ã€â†’ é‡è½½ `wheelEvent()`ï¼ˆ**è™šå‡½æ•°**ï¼‰

### ã€Œ**ç”¨æ™®é€šæ¥å£ vs å¿…é¡»è™šå‡½æ•°**ã€çš„**çº¢ç»¿ç¯è¡¨

------------------------------------------------
ğŸŸ¢ æ™®é€šæ¥å£å°±å¤Ÿï¼ˆ**ä¸è°ƒä¹Ÿèƒ½è·‘**ï¼‰

| åŠŸèƒ½                  | æ¥å£/è®¾ç½®                                                    | æ˜¯å¦å¿…é¡»è‡ªå·±å†™ä»£ç                     |
| --------------------- | ------------------------------------------------------------ | ------------------------------------- |
| æ— çˆ¶å…¨å±€èœå• + å¿«æ·é”® | `QAction::setShortcut`                                       | **é›¶ä»£ç **ï¼Œèœå•æ æŒ‚ action å³å¯      |
| ç”»å¸ƒæ•´ä½“æ‹–åŠ¨          | `view.setDragMode(ScrollHandDrag)`                           | **ä¸€è¡Œè®¾ç½®**ï¼Œè‡ªå¸¦æ‰‹å‹                |
| åŒæŒ‡æ»‘åŠ¨å¹³ç§»          | `view.grabGesture(Qt.PanGesture)`                            | **ä¸€è¡Œæ³¨å†Œ**ï¼Œæ”¶ `QPanGesture` å³å¯   |
| åŒæŒ‡æåˆç¼©æ”¾          | `view.grabGesture(Qt.PinchGesture)`                          | **ä¸€è¡Œæ³¨å†Œ**ï¼Œæ”¶ `QPinchGesture` å³å¯ |
| æ»šè½®ç¼©æ”¾              | `view.wheelEvent` é‡Œ `scale()`                               | å¯é€‰é‡è½½ï¼Œ**é»˜è®¤ä¹Ÿèƒ½ç¼©æ”¾**            |
| å³é”®èœå•(ä¸€è‡´çš„)      | # 1. è®©è§†å›¾èƒ½å‘å³é”®ä¿¡å·<br />self.setContextMenuPolicy(Qt.CustomContextMenu)<br /># 2. è¿æ¥ä¿¡å· â†’ æ™®é€šæ§½å‡½æ•°ï¼ˆéè™šå‡½æ•°ï¼‰<br />self.customContextMenuRequested.connect(èœå•å‡½æ•°ä¸‹é¢æ˜¯2è¡Œæ ¸å¿ƒä»£ç )<br />menu = QMenu()<br />menu.exec(self.mapToGlobal(pos)) |                                       |

------------------------------------------------
ğŸ”´ å¿…é¡»è™šå‡½æ•°ï¼ˆ**ä½ ä¸å†™ï¼ŒQt ä¸ä¼šå¸®ä½ **ï¼‰

| åŠŸèƒ½                          | è™šå‡½æ•°                                          | åŸå›                                             |
| ----------------------------- | ----------------------------------------------- | ----------------------------------------------- |
| **ç©ºç™½ vs Item ä¸åŒå³é”®èœå•** | `Scene::contextMenuEvent`                       | ç³»ç»Ÿåªåˆ†å‘ä¸€æ¬¡ï¼Œ**ä½ å¿…é¡» hitTest åå†³å®šç»™è°å¼¹** |
| **Item é”®ç›˜+é¼ æ ‡ç»„åˆ**        | `Item::keyPressEvent` + `Item::mousePressEvent` | **Item æ‰æ”¶å¾—åˆ°**ï¼ŒScene/View ä¸ä¼šè‡ªåŠ¨è½¬å‘      |
| **æ‰‹åŠ¿å…œåº•/æ–°äº‹ä»¶**           | `View::event()`                                 | åªæœ‰è¿™é‡Œèƒ½å…ˆæ‹¦æˆª**æœªå…¬å¼€**äº‹ä»¶                  |

------------------------------------------------
ğŸŸ¡ å¯é€‰è™šå‡½æ•°ï¼ˆ**æ™®é€šæ¥å£ä¹Ÿèƒ½è·‘ï¼Œä½†é‡è½½æ›´ç²¾ç»†**ï¼‰

| åŠŸèƒ½             | æ™®é€šæ¥å£                  | é‡è½½å¥½å¤„               |
| ---------------- | ------------------------- | ---------------------- |
| æ»šè½®ç¼©æ”¾         | `wheelEvent` é‡Œ `scale()` | å¯æ§åˆ¶å€ç‡ã€é”šç‚¹ã€åŠ¨ç”» |
| ç”»å¸ƒè¾¹ç•Œè‡ªåŠ¨æ‰©å¤§ | `scene.setSceneRect`      | å¯åŠ¨æ€è®¡ç®—ï¼Œä¸ç”¨æ¯å¸§è°ƒ |

------------------------------------------------
ç»“è®º

> **ã€Œå…¨å±€èœå•ã€æ•´ä½“æ‹–åŠ¨ã€åŒæŒ‡æ»‘åŠ¨/æåˆã€æ»šè½®ç¼©æ”¾ã€** â†’ **æ™®é€šæ¥å£ä¸€è¡Œæå®š**  
> **ã€Œç©ºç™½/Item ä¸åŒèœå•ã€Item ç»„åˆé”®ã€æ–°æ‰‹åŠ¿å…œåº•ã€** â†’ **å¿…é¡»å†™è™šå‡½æ•°**  

- **æ™®é€šæ¥å£**è´Ÿè´£ã€Œ**æ•´ä½“è¡Œä¸º**ã€  
- **è™šå‡½æ•°**åªè´Ÿè´£ã€Œ**å‘½ä¸­æµ‹è¯• + Item ç§æœ‰äº¤äº’**ã€  

