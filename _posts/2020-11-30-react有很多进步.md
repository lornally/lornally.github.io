> coffee真的很简洁. 但是在函数参数和返回值这里还可以更简洁. 比如规定必须用键值对(对象)作为参数和返回值, 那么小括号和大括号都可以省略了. 

###### IIFE

- 用do就可以了. 

###### 双重循环生成扁平不重复数组

```coffeescript
getpointpair= (e)->
#写法一	因为两重循环外层push内层结果, 所以需要flat
	({from: e[x], to: j} for x in [i+1...e.length] for j,i in e).flat()
#写法二 也可以自己弄一个数组作为返回结果
	res=[]
	for j,i in e
		res.push({from: e[x], to: j}) for x in [i+1...e.length]
	res
#和flat等价的写法, 这里xxx是一个数组
[].concat xxx...
```

###### 判空运算符

```coffeescript
zip = lottery.drawWinner?.address?.zipcode
zip = lottery.drawWinner ?.address ?.zipcode
# 这两个是不一样的. 有空格代表属性, 直接用null判断, 没有空格代表方法, 会用function类型判断
# 但是如果用在if里面必须没有空格
for x in p
		if x.E?
			siteshowinfo["点位"]=true
<>{ if p? then <Boxc text="点" onClick={show type:'point'}/>}</>
```

###### 对象简写不可以省略大括号

- CoffeeScript has a shortcut for creating objects when you want the key to be set with a variable of the same name. that the { and } are required for this shorthand.
- why?
- CoffeeScript  shortcut key value same name. why  {  } 
- 因为多参数的判断问题. 本来coffe的实现时合理的. 架不住很多人提bug. 作者就修复了这个.

###### function组件时react推荐的写法

```jsx
//组件使用函数写法, 不要使用class写法
function Welcome(props) {
  return <h1>Hello, {props.name}</h1>;
}
```

- 时代在进步stata也可以用function写法了

```coffeescript
import style from  "./style.module.sass"
import React, { useState }  from 'react'
import ReactDOM from 'react-dom'
export Hello = (props) ->
	[count, setCount] = useState(0)
	<div className={style.moduleclass}>
		<h1>props hello hahaha oeuaoeu {props.name}</h1>
		<p>You clicked {count} times</p>
      <button onClick={ -> setCount count + 1}>
        Click me
      </button>
  </div>

ReactDOM.render	<Hello name="天才"/>,document.getElementById('reactcontainer')
```

- react的层次概念其实有点烦, 想想传递参数要一层层传递下去. 
- 牛啊, 即便不用hooks, 也可以functional的写react. 不过要用prototype而已. 语法上面比较唠叨, 语法糖还是需要的.
- functional component 如何在循环中传递参数?
  - data-xxx的写法没有试验成功.
  - 立即执行函数返回处理函数, 这个写法是OK的示例如下

```coffeescript
onClick = (n, x) ->
		(e) -> #这里返回事件的处理函数
			setcheckindex n #e.target.dataset.index
			x() #e.target.dataset.fun()

	<Boxr key={x.text} check={checkindex==n} text={x.text} 
  onClick={onClick(n, x.onClick)} #这个写法是关键, 这里有一个立即执行的函数, 他返回事件处理函数, 这样参数就保留在了这个处理函数的外部作用域. 就避免了for循环只有最终循环终点值生效的问题.
  # 数遍说一句, 胖箭头函数也没有成功. 可能是babel/webpack/coffee的问题.
	data-index={n} data-fun={x.onClick} # 这两个没有用, 函数中没有拿到.
  /> for x,n in g
```

- react每个组件都必须单根, 不是单根也默默地不报错, 但是, 就是执行就很诡异...., 2020年11月, 只处理最后一个元素.



###### 参考

- https://coffeescript-cookbook.github.io/chapters/arrays/concatenating-arrays