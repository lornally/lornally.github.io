> 最近再做js编辑器, 发现编辑的事件是个课题

###### 有可能使用的事件

- key
  - keydown
  - keyup
  - keypress 不会被中文触发.
- observer
- change
- input

###### 实际测试key事件

- onkeyup, 其他ok, 
  - tab依旧会跳走
  - enter, 会莫名加div(顽固的执行系统原有策略)
  - delete/backspace会删除一个字符然后再执行后面的脚本.
- onkeydown
  - 这里才是处理/s的地方, tab, enter, delete/backspace全都正常.
  - 中文会触发, 我们只要不理他就好了.
  - 很神奇, 我试验出来, space不响应这个触发.
  - 很神奇, 睡了一觉之后, 这个问题不见了, 果然睡眠改变命运.
- onkeypress
  - 如果没有e.preventDefault();那么顺序是: keydown -> keypress -> keyup
  - 如果做了e.preventDefault(); 那么顺序是: keydown -> keyup, 这里keypress不会被触发.
  - 这个是即将废弃的事件mdn预告了
  - 这个很多时候不能呼出的原因是浏览器纷纷有自己不支持的按键了, 各种按键都不能触发keypress了.

###### 要忽略输入法这么做: (mdn都有答案了!!!!)

- https://www.fxsitecompat.com/en-CA/docs/2018/keydown-and-keyup-events-are-now-fired-during-ime-composition/

```js
//https://developer.mozilla.org/en-US/docs/Web/Events/keydown
if (event.isComposing || event.keyCode === 229) {
    return; //这样就可以忽略输入法的中间输入了.
}
```

###### 键值的区别

- `keydown` and `keyup` provide a code indicating which key is pressed, while `keypress` indicates which character was entered. For example, a lowercase "a" will be reported as 65 by `keydown` and `keyup`, but as 97 by `keypress`. An uppercase "A" is reported as 65 by all events. 

###### 空格

- 229代表输入法在处理这个按键. 
- 只有safari有这个问题, 并且要开输入法才有. 英文状态没有问题.
- chrome没有这个问题.
- keydown会出现229, 如果是中文输入法.  这个表现其实大部分情况是完美的, 毕竟用户在选字的时候, 要的不是真的输入.
- keyup不论什么输入法, 都会是正常的code. 
- 因此, 空格确实需要keyup

###### 测试tab

- tab可以插入和显示, 但是好短.  问题来了, 如何让tab看起来有4个空格那么大(浏览器里面2个空格都很小的)?
- 原因找到了, 不论是多少个空格或者tab, 再html里面都会处理为一个单独的空格, 这个是原本的规范.

1. 需要先解决vscode的问题, 
   1. vscode会自动转化tab为空格. 关键字: tab.
   2. 并且vscode再保存文件的时候的格式化, 还会无差别处理div里面的tab, 也不利于我的测试. 也需要关掉, 关键字: save.
2. 然后, pre里面的tab确实生效了, 而且默认是4个空格. 但是editable的div里面的tab依旧没有生效.

tab的编码:

```js
let tab='\t';
tab='&#9;';
// ASCII character 9, or Unicode U+0009.
```



绕行(这是一个可行的方案):

1. nbsp
2. ensp 2空格
3. emsp 4空格

>  参考: https://www.quora.com/How-do-you-add-a-tab-space-in-HTML

由此产生了一个疑问?  如果用pre +contenteditable, 可以吗?  答案竟然是可行. 那么针对tab我们有两个答案了: 

1. 使用pre +contenteditable, 这个tab表现完美, 其他表现不知道, 随缘吧.
2. 使用emsp, 貌似解决问题, 反复转码之后, 不知道是个神马玩意了. 
3. 竟然发现了方案三: execCommand('indent', false, null) 尝试一下. 这个问题很明显, tab只是加在行首, 中间加不进去.  而且实际上添加了blockquote元素

> tab暂时告一段落.   才叫见鬼…..

4. 因为我有发现了各种解决方案比如: white-space: pre,  white-space: pre-wrap, 这个是完美的解决方案, 完美的令人发指……, 这是已知的终极解决方案.

###### tab的最终解决方案

```css
.tabstop {
    -moz-tab-size: 40;
    -o-tab-size: 40;
    tab-size: 40;
    white-space: pre-wrap;
}

.whitespace {
    white-space: pre;
    -moz-tab-size: 40;
    -o-tab-size: 40;
    tab-size: 40;
}
tab编码: '\t';'&#9;';// ASCII character 9, or Unicode U+0009.
```

white-space: pre和pre-wrap的区别:

- pre will only wrap on line breaks so pre-wrap is probably preferable to avoid a horizontal scroll bar.
- 因此我们用pre-wrap是最合理的.

> 除了万能的Stack Overflow, https://codeitdown.com/css/tab-size/
>
> https://stackoverflow.com/questions/2237497/how-to-make-the-tab-key-insert-a-tab-character-in-a-contenteditable-div/2237548#2237548    这里面的meouw的答案.

