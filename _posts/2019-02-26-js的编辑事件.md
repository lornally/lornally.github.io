> 最近再做js编辑器, 发现编辑的事件是个课题

###### 有可能使用的事件

- key
  - keydown 最先被触发
  - keypress 不会被中文触发. 输入了文字, 但是, 文字还没有上去.
  - keyup 最后触发, 文字上去了已经.
- observer
- change
- input

###### 实际测试key事件

- onkeyup, 其他ok, 
  - tab依旧会跳走
  - enter, 会莫名加div(顽固的执行系统原有策略)
  - delete/backspace会删除一个字符然后再执行后面的脚本.
- onkeydown
  - 这里才是处理/s的地方, tab, enter, delete/backspace全都正常.
  - 中文会触发, 我们只要不理他就好了.
  - 很神奇, 我试验出来, space不响应这个触发.
  - 很神奇, 睡了一觉之后, 这个问题不见了, 果然睡眠改变命运.
- onkeypress
  - 如果没有e.preventDefault();那么顺序是: keydown -> keypress -> keyup
  - 如果做了e.preventDefault(); 那么顺序是: keydown -> keyup, 这里keypress不会被触发.
  - 这个是即将废弃的事件mdn预告了
  - 这个很多时候不能呼出的原因是浏览器纷纷有自己不支持的按键了, 各种按键都不能触发keypress了.

###### 要忽略输入法这么做: (mdn都有答案了!!!!)

- https://www.fxsitecompat.com/en-CA/docs/2018/keydown-and-keyup-events-are-now-fired-during-ime-composition/

```js
//https://developer.mozilla.org/en-US/docs/Web/Events/keydown
if (event.isComposing || event.keyCode === 229) {
    return; //这样就可以忽略输入法的中间输入了.
}
```

###### 键值的区别

- `keydown` and `keyup` provide a code indicating which key is pressed, while `keypress` indicates which character was entered. For example, a lowercase "a" will be reported as 65 by `keydown` and `keyup`, but as 97 by `keypress`. An uppercase "A" is reported as 65 by all events. 

###### 空格

- 229代表输入法在处理这个按键. 
- 只有safari有这个问题, 并且要开输入法才有. 英文状态没有问题.
- chrome没有这个问题.
- keydown会出现229, 如果是中文输入法.  这个表现其实大部分情况是完美的, 毕竟用户在选字的时候, 要的不是真的输入.
- keyup不论什么输入法, 都会是正常的code. 
- 因此, 空格确实需要keyup



###### 有用的事件:  beforeinput

- 在input被真正改变之前触发
- https://developer.mozilla.org/en-US/docs/Web/Events/beforeinput

###### input事件也有用

- https://developer.mozilla.org/en-US/docs/Web/Events/input
- 这个事件等于change事件, 不过他是再editable元素上触发.

###### keyboardevent

- https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent
- 一定要看英文版. 比如按键顺序:

1. `keydown`
2. `keypress`
3. `keydown`
4. `keypress`
5. <<repeating until the user releases the key>>
6. `keyup`